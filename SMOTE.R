#Function to SMOTE data by cluster
smotecluster <- function(datafile){
  library('DMwR')
  library('plyr')
  #change heat illness into yes or no
  datafile$heat_illness[datafile$heat_illness > 1] <- 1
  #make date and heat illness into factors
  datafile$heat_illness = as.factor(datafile$heat_illness)
  datafile$month = as.factor(datafile$month)
  datafile$year = as.factor(datafile$year)
  datafile$cluster = as.factor(datafile$cluster)
  #create empty data frame
  completeSmote <- data.frame()
  #find number of clusters in datafile
  numofclusters <- length(unique(datafile$cluster))
  #for loop that performs SMOTE for each region
  for (var in 1:numofclusters){
    region <- subset(datafile, datafile['cluster'] == var)
    balanced_region <- SMOTE(heat_illness ~., region,  perc.over = 20000, k = 3, perc.under = 200)
    completeSmote <- rbind(completeSmote, balanced_region)
  }
  return(completeSmote)
}

#splitting the data set
library(caTools)
split <- sample.split(completeSmote$heat_illness, SplitRatio = 0.75)
balancedtrain <- subset(completeSmote, split == TRUE)
balancedtest <- subset(completeSmote, split == FALSE)

as.data.frame(table(balancetrain$heat_illness))
as.data.frame(table(balancetest$heat_illness))

#create the files
write.csv(balancetrain,"~/Desktop/Data Sets/15 cluster training data.csv", row.names = FALSE)
write.csv(balancetest,"~/Desktop/Data Sets/15 cluster testing data.csv", row.names = FALSE)