#load in new data and add cluster number
library(plyr)
daily_temp <- read.csv('daily_temp_zip_04t13.csv', header = TRUE)
heat_hospitalizations <- read.csv('Heat hospitalisations California.csv', header = TRUE)

cluster_zip <- read.csv('15 clusters zip.csv', header = TRUE)
balance_example <- merge(combined_heathosp, cluster_zip, by = c('zipcode'), all.x = TRUE)
print(balance_example)
balance_example <- subset(balance_example, 
                          select = c('heat_illness', 'month', 'year', 'temp_diff', 'mintemp', 'maxtemp', 'cluster'))
balance_example <- subset(balance_example, is.na(balance_example) == FALSE)

#SMOTE - balancing the data
library('DMwR')
smoteData_region5 <- SMOTE(heat_illness ~., balance_example,  perc.over = 120000, k = 5, perc.under = 90)
smoteData <- smoteData_region5
as.data.frame(table(smoteData_region5$heat_illness))

#split the data
library(caTools)
split <- sample.split(smoteData$heat_illness, SplitRatio = 0.75)
balancetrain <- subset(smoteData, split == TRUE)
balancetest <- subset(smoteData, split == FALSE)

as.data.frame(table(balancetrain$heat_illness))
as.data.frame(table(balancetest$heat_illness))

#create the files
write.csv(balancetrain,"~/Desktop/Data Sets/15 cluster training data.csv", row.names = FALSE)
write.csv(balancetest,"~/Desktop/Data Sets/15 cluster testing data.csv", row.names = FALSE)
