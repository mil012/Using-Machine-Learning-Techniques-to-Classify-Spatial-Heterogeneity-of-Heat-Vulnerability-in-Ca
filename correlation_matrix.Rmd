---
title: "Correlation Matrices"
output: html_notebook
---


```{r}
library(dplyr)
library(rpart)
library(randomForest)
library(lubridate)
install.packages("corrplot")
library(corrplot)
```


```{r}
#Rename dataframe
info <- zipcode_info
```



```{r}
#Clean data
names(info)[names(info)=="zipcode"] <- "zipnum"
clusters_15 <- subset(clusters_15, select= -X)
names(clusters_15)[names(clusters_15)=="X1"] <- "zipnum"
names(clusters_15)[names(clusters_15)=="X2"] <- "cluster"
names(hpi)[names(hpi)=="ZIP"] <- "zipnum"
hospitalizations$date <- as.Date(hospitalizations$date, format="%d%b%Y") #Convert dates to y-m-d
names(hospitalizations)[names(hospitalizations)=="patzip"] <- "zipnum" #Change zip code column name
heat <- data.frame(heat_illness = hospitalizations$heat_illness, zipnum = hospitalizations$zipnum, date = hospitalizations$date)
daily_temp$date <- as.Date(daily_temp$date)
```


```{r}
#Correlation matrix on HPI variables
#Note: All values are percentiles
hpi_variables <- cbind(zipnum = hpi$zipnum, economic = hpi$economic_pctile, education = hpi$education_pctile, housing = hpi$houseing_pctile, healthcare = hpi$healthcareaccess, neighborhood = hpi$heighborhood_pctile, pollution = hpi$pollution_pctile, transportation = hpi$transportation_pctile, insured = hpi$insured_pctile, uncrowded = hpi$uncrowded_pctile, homeownership = hpi$homeownership_pctile, automobile = hpi$automobile_pctile, commute = hpi$communte_pctile, employed = hpi$employed_pctile, above_poverty = hpi$abovepoverty_pctile, tree_canopy = hpi$treecanopy_pctile, ownsevere = hpi$ownsevere_pctile, ozone = hpi$ozone_pctile, pm25 = hpi$pm25_pctile, dieselpm = hpi$dieselpm_pctile, h20contam = hpi$h20contam_pctile)
hpi_variables <- as.data.frame(apply(hpi_variables, 2, as.numeric))
corr = cor(hpi_variables, use = "complete.obs")
corrplot(corr)
corr
```

```{r}
#Looking at correlation matrix above, remove highly correlated variables
hpi_variables <- subset(hpi_variables, select = -economic)
hpi_variables <- subset(hpi_variables, select = -insured)
hpi_variables <- subset(hpi_variables, select = -pollution)
hpi_variables <- subset(hpi_variables, select = -housing)
hpi_variables <- subset(hpi_variables, select = -above_poverty)
```


```{r}
#Create updated correlation matrix on HPI variables remaining
#Note: All values are percentiles
hpi_variables <- as.data.frame(apply(hpi_variables, 2, as.numeric))
corr = cor(hpi_variables, use = "complete.obs")
corrplot(corr)
corr
```


